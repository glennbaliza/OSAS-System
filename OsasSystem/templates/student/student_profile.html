{% extends 'base.html'%}
{% load static %}

{% block page-css %}
    <!-- <link href="{% static 'OsasSystem/assets/plugins/DataTables/media/css/dataTables.bootstrap.min.css' %}" rel="stylesheet" />
	<link href="{% static 'OsasSystem/assets/plugins/DataTables/extensions/Responsive/css/responsive.bootstrap.min.css' %}" rel="stylesheet" /> -->
{% endblock%}

{% block title %}
    Student Profile
{% endblock %}


{% block content%}
<div id="content" class="content">

    {% if messages %}
    <p class="alert alert-danger">
        {% for message in messages %}
            <i><strong>{{ message }}</strong></i>
        {% endfor %}
    </p>
    {% endif %} 

    <h1 class="page-header mb-1">Student Profile</h1>
	<p class="mb-5">Page Description</p>
    <!-- end page-header -->
    <!-- begin panel -->
			<div class="panel">
				<div class="panel-heading p-25">
					<div class="btn-group btn-group-toggle pull-right" data-toggle="buttons">
						<button class="btn btn-success"  data-toggle="modal" href="#modal-dialog" id="btn_rem"><i class="fas fa-search mr-2"></i>Add New</button>
					</div>
					<h2 class="panel-title" style="font-size:16px;">Student Information</h2>
				</div>
				<div class="panel-body">
                    {% if student_info %}
					<table id="data-table" class="table table-striped table-bordered">
						<thead>
							<tr>
								<th width="1%"></th>
								<th data-orderable="false">Student</th>
								<th data-orderable="false">Action</th>
							</tr>
						</thead>
						<tbody>
                            {% for osas_r_personal_info in student_info %}
							<tr class="odd gradeA">
								<td width="1%" class="f-s-600 text-inverse">{{ osas_r_personal_info.stud_id }}</td>
								<td><dl class="row mb-0 p-2" style="line-height: .6rem;">
                                    <dd class="col-sm-8 gritter-" ><strong>{{ osas_r_personal_info.stud_no }}</strong></dd>
                                    <dd class="col-sm-8">{{ osas_r_personal_info.stud_lname }} {{ osas_r_personal_info.stud_fname }}  {{ osas_r_personal_info.stud_mname }}</dd>
                                    <dd class="col-sm-8">{{ osas_r_personal_info.stud_course_id }} {{ osas_r_personal_info.stud_yas_id }}</dd>
                                    <dd class="col-sm-8" id="dateofbirth" hidden>{{ osas_r_personal_info.stud_birthdate }}</dd>
                                    <dd class="col-sm-8">{{ osas_r_personal_info.stud_email }}</dd>
                                    <dd class="col-sm-8">{{ osas_r_personal_info.stud_m_number }}</dd>
                                </dl>
								</td>
								<td><div class="text-nowrap"><div class="btn-group ">
									<button id="view-btn" class="btn btn-white" ><i class="fas fa-search mr-2"></i>View</button>
									<a href="{% url 'edit_student' osas_r_personal_info.stud_id %}"><button id="edit-btn" class="btn btn-info" ><i class="fas fa-edit mr-2"></i>Edit</button></a>
									<button id="delete-btn" class="btn btn-danger" ><i class="fas fa-trash-alt mr-2"></i>Delete</button>
								  </div>
								</td>
                            </tr>
                            {% endfor %}
						</tbody>
                    </table>
                    {% endif %}
				</div>
			</div>
</div>
 <!-- #modal-dialog -->
<div class="modal fade" id="modal-dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content ">
            <div class="modal-body ">
                <form id="validate_form"  action="{% url 'student_process_add' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <fieldset >
                        <tr>
                            <td>
                                <strong><h1 class="page-header">Add new student</h1></strong>
                                <div class="row">
                                    <hr style="width:100%;text-align:left;margin-left:0">
                                    <div class="col-lg-4 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Last name</label>
                                            <input  style="margin-bottom: 8px;" type="text" id="txt_l_name" name="txt_l_name" class="form-control" placeholder="Last name" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>		
                                    <div class="col-lg-4 col-md-6 ">
                                        <div class="stats-content">
                                            <label>First name</label>
                                            <input  type="text" id="txt_f_name" class="form-control" name="txt_f_name" placeholder="First name" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Middle name</label>
                                            <input  type="text" id="txt_m_name" class="form-control" name="txt_m_name" placeholder="Middle name" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Student number</label>
                                            <input style="margin-bottom: 8px;" type="text" id="txt_studno" name="txt_studno" placeholder="ex. 2000-0000-cm-0" class="form-control" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                        
                                    <div class="col-lg-4 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Date of birth</label>
                                            <input type="date" class="form-control" name="date_of_birth" id="datepicker" data-date-format="yy-mm-dd" placeholder="{% now 'Y-m-d' %}" >
                                        </div>
                                        <div id="datepicker"></div>
                                    </div>
                                    <div class="col-lg-4 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Gender</label>
                                            <select id="txt_Gender" name="txt_Gender" class="form-control">
                                                    <option  value="Male">Male</option>
                                                    <option  value="Female">Female</option>
                                                    <option  value="Others">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Address</label> 
                                            <input style="margin-bottom: 8px;" type="text" id="txt_address" name="txt_address" class="form-control" placeholder="Adress" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Email Address</label>
                                            <input style="margin-bottom: 8px;" type="email" id="txt_email" name="txt_email" placeholder="" class="form-control" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Mobile number</label>
                                            <input  type="text" id="txt_mobile_number" class="form-control" name="txt_mobile_number" placeholder="ex. 09123456789" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
            
                                    <div class="col-lg-7 col-md-6 ">
                                        <div class="stats-content">
                                            <label >Course</label>
                                            {% if student_course %}
                                            <select id="dd_course" name="txt_course" class="form-control">
                                                <option selected disabled="true">--Select Course--</option>
                                                {% for osas_r_course in student_course %}
                                                <option value="{{ osas_r_course.course_name }}" name="txt_course" name="txt_course" >{{ osas_r_course.course_name }}</option>
                                                {% endfor %}
                                                <!-- {% for osas_r_course in course_list %}  
                                                <option value="{{ osas_r_course.course_id }}">{{ osas_r_course.course_name }}</option>
                                                {% endfor %} -->
                                            </select>
                                            {% endif %}
                                        </div>
                          
                                    </div>
                                    <div class="col-lg-5 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Year & Section</label>
                                            {% if student_yr_sec %}
                                            <select id="dd_yr" name="txt_yr_sec" class="form-control" >
                                                    <option selected disabled="true">--Select Year and Section--</option>
                                                    {% for osas_r_section_and_year in student_yr_sec%}
                                                    <option  value="{{ osas_r_section_and_year.yas_descriptions }}" name="txt_yr_sec">{{ osas_r_section_and_year.yas_descriptions }}</option>
                                                    {% endfor %}
                                            </select>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <hr style="width:100%;text-align:left;margin-left:0">
                                    <div class="col-lg-6 col-md-6 ">
                                        <div class="stats-content">
                                            <label>High school name</label>
                                            <input style="margin-bottom: 8px;" type="text" id="txt_h_name" name="txt_h_name" class="form-control" placeholder="School name" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-6 ">
                                        <div class="stats-content">
                                            <label>High school address</label>
                                            <input style="margin-bottom: 8px;" type="text" id="txt_h_address" name="txt_h_address" class="form-control" placeholder="School address" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Emergency contact person</label>
                                            <input  type="text" id="txt_e_name" name="txt_e_name" class="form-control" placeholder="Full name" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Emergency contact person number</label>
                                            <input style="margin-bottom: 8px;" type="text" id="txt_e_number" name="txt_e_number" placeholder="ex. 09123456789" class="form-control" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-6 ">
                                        <div class="stats-content">
                                            <label>Emergency contact person address</label>
                                            <input  type="text" id="txt_e_address" name="txt_e_address" class="form-control" placeholder="Address" required data-parsley-trigger="keyup">
                                        </div>
                                    </div>
                                    <hr style="width:100%;text-align:left;margin-left:0">
                                </div>
                            </td>
                        </tr>
                    </fieldset>
                    </br>
                    <div style=" margin-bottom: 20px;" class="btn pull-right">
                        <button id="submit" type="submit" class="btn btn-success btn-sm btn-sm">Add</button>  
                    </div>
                </form>  
            </div>  
        </div>
    </div>
</div>

{% endblock %}

{% block page-level %}
	<script src="{%static 'OsasSystem/assets/plugins/bootstrap-sweetalert/sweetalert.min.js' %}"></script>
    <script src="{%static 'OsasSystem/assets/js/demo/ui-modal-notification.demo.min.js' %}"></script>
    <script src="{%static 'OsasSystem/assets/index.js' %}"></script>
{% endblock %}

{% block page-js %}
<script>
    //https://stackoverflow.com/questions/3072233/getting-value-from-table-cell-in-javascript-not-jquery
    var table = document.getElementById('data-table');
    var rowCount = table.rows.length; 
    for (var r = 1, n = table.rows.length; r < n; r++) {
        var table = document.getElementById("dateofbirth").innerHTML
        console.log(table)
        if (moment(table, 'YYYY-MM-DD', true).isValid()) {
        }
        else {           
            const stud_dob_temp = moment(table, ['MMMMDDY']).format();
            const dob = moment(stud_dob_temp) // setting the new formatted date
            document.getElementById("dateofbirth").innerHTML = dob.format('YYYY-MM-DD')
            console.log("Today's date is: " + 
            dob.format('YYYY-MM-DD'))   
        }
    }

    $('#validate_form').on('submit', function(event){
        var datetemp = document.getElementById("datepicker").value;    
        alert(datetemp)     
        var selectedValue = $(this).text();
        dd_course = $("#dd_course").children("option:selected").val();
        dd_yr = $("#dd_yr").children("option:selected").val();
    
    $.ajax({
    url : "{% url 'student_process_add' %}",
    type : "GET",
    data : {
        course: dd_course,
        yr_sec: dd_yr,
        csrfmiddlewaretoken: "{{ csrf_token }}",
    },
    success : function(){
        swal("SUCCESS! "+categ+" HAS BEEN INSERTED", {
			              icon: "success",
			            }).then((willreload) => {
			            	if(willreload){
			            		window.location.reload()
			            	}
			            });
				
				console.log(data["response"]);
    },
    error: function(error){
				console.log(error);
    }

  });
});

</script>
{% endblock %}