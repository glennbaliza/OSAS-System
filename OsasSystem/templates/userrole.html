{% extends 'base.html'%}
{% load static %}

{% block page-css %}
    <link href="{% static 'OsasSystem/assets/plugins/DataTables/media/css/dataTables.bootstrap.min.css' %}" rel="stylesheet" />
	<link href="{% static 'OsasSystem/assets/plugins/DataTables/extensions/Responsive/css/responsive.bootstrap.min.css' %}" rel="stylesheet" />
{% endblock%}

{% block title %}
    User Role
{% endblock %}

{% block content %}
{% if request.session.session_user_role == 'HEAD OSAS'%}
<div class="modal fade" id="modal-dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">User Role</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="validate_form" data-parsley-validate="" action="{% url 'adduserrole' %}" method="post" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-lg-12 col-md-6">
                        {% csrf_token %}
                            {% if messages %}
                                {% for message in messages %}
                                    {% if message.tags %}  <script>alert("{{ message }}")</script> 
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        </div>
                    </div>
                    {% csrf_token %}
                    <div class="col-lg-12 col-md-6 ">
                        <div class="stats-content">
                            <label>Descriptions</label>
                            <input type="text" name="userrole" id="userrole"  class="form-control" required  data-parsley-trigger="keyup"> 
                        </div>
                    </div>
                    <!-- </br>
                    <div class="col-lg-12 col-md-6 ">
                        <div class="stats-content">
                            <label>User Image</label>
                            <input type="file" name="image" id="image"> 
                        </div>
                    </div> -->
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success btn-sm btn-sm">Add</button>  
                        <button type="cancel" class="btn btn-warning btn-sm btn-sm" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>  
        </div>
    </div>
</div>
<!-- #modal-without-animation -->
<div id="content" class="content">
    <div class="row">
        <div class="col-lg-12 col-md-6">
            <button type="button" href="#modal-dialog" id="btn_rem"  class="update btn btn-danger" data-toggle="modal">+ Add new user role<span class="glyphicon glyphicon-trash"></span></button> 
        </div>
    </div>
</br>
    <!-- begin row -->
    <div class="row">
        <!-- begin col-10 -->
        <div class="col-lg-12 col-md-6">
            <!-- begin panel -->
            <div class="panel panel-inverse">
                <!-- begin panel-heading -->
                <div class="panel-heading">
                    <div class="panel-heading-btn">
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-redo"></i></a>
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                    </div>
                    <h4 class="panel-title">User List</h4>
                </div>
                <!-- end panel-heading -->
                <!-- begin panel-body -->
                <div class="panel-body">
                    {% if user_list %}
                    <div class="table-responsive">
                        <table id="data-table-buttons" class="table table-striped table-bordered " >
                        <thead>
                            <tr>
                                <th hidden></th>
                                <th class="text-nowrap">User Type</th>
                                <!-- <th class="text-nowrap">Profile Picture</th> -->
                                <!-- <th class="text-nowrap">Status</th> -->
                                <th class="text-nowrap text-right">Action</th>  
                            </tr>
                        </thead>
                        <tbody>
                            {% for osas_r_userrole in user_list %}
                            <tr>
                                <td hidden >{{ osas_r_userrole.user_id }}</td>  
                                <td>{{ osas_r_userrole.user_type }}</td>
                                <!-- <td class="text-center"><img src="/media/{{osas_r_userrole.s_image}}" class="rounded-circle" width="50" alt="userimage"/></td> -->
                                <!-- <td class="text-center"><span {% if  index.2  < index.3 %}class = "dot" style=" height: 25px; width: 25px; background-color: red; border-radius: 50%;display: inline-block;" {% elif  index.2  == index.3 %}class = "dot" style=" height: 25px; width: 25px; background-color: #EEA843; border-radius: 50%;display: inline-block;" {% else %} class="dot" style=" height: 25px; width: 25px; background-color: #4EEC1E; border-radius: 50%; display:inline-block;" {% endif %}></span></td> -->
                                <td class="with-btn text-right" nowrap >
                                    <!-- {% if index.2 < index.3 %}
                                    <a id="btnEditTable"  value="{{index.0}}" class="btn btn-sm btn-primary width-70 m-r-2" style="color: white;">Order</a>
                                    {% endif %} -->
                                    <!-- <button type="button" id="view" class="update btn btn-primary btn-lg"><span class="glyphicon glyphicon-eye-open"></span></button> -->
                                    <a href="{% url 'edit_user' osas_r_userrole.user_id %}"><button type="button"  id="edit"  class="update btn btn-warning btn-lg"><span class="glyphicon glyphicon-pencil"></span></button></a>
                                    <!-- <a id="btnEditTable"  value="{{index.0}}" class="btn btn-sm btn-primary width-70 m-r-2" style="color: white;">Edit</a> -->
                                    <!-- {% if request.session.session_assign == 9 %} -->
                                    <button type="button" href="#modal-dialog" id="btn_rem"  class="update btn btn-danger btn-lg" data-toggle="modal"><span class="glyphicon glyphicon-trash"></span></button> 
                                    <!-- <a  class="btn btn-sm btn-success" data-toggle="modal">Demo</a> -->
                                    <!-- {% endif %} -->
                                    <button type="button" id="button_del" method="post" class="update btn btn-danger btn-lg"><span class="glyphicon glyphicon-trash"></span></button> 
                                    <!-- <a id="btnRemarks"  class="btn btn-sm btn-white width-70"><center>Remarks</center></a>
                                     -->
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
                <!-- end panel-body -->
            </div>
            <!-- end panel -->
        </div>
        <!-- end col-10 -->
    </div>
    <!-- end row -->
</div>
{% endif %}
 <!-- #modal-dialog -->


<!-- begin #content -->

 
    <!-- begin page-header -->
    <h1 class="page-header">Unauthorize view</h1>
    <!-- end page-header -->
    <!-- begin row -->
    
    
<!-- end #content -->
<!-- end page container -->


{% endblock %}

{% block page-level %}
	<script src="{%static 'OsasSystem/assets/plugins/bootstrap-sweetalert/sweetalert.min.js' %}"></script>
	<script src="{%static 'OsasSystem/assets/js/demo/ui-modal-notification.demo.min.js' %}"></script>
{% endblock %}

{% block page-js %}
<script>

var table = $('#data-table-buttons').DataTable();

 table.buttons( 0, null ).containers().appendTo( 'body' );

    // $("#data-table-buttons").DataTable({
    //     buttons: [ 'copy', 'csv', 'excel' ]
    // })
    $("#validate_form").parsley();

    id = $(this).closest("tbody tr").find("td:eq(0)").html()

 
        

    $("#data-table-buttons").on('click','#button_del',function(){
        id = $(this).closest("tbody tr").find("td:eq(0)").html()
        alert(id)
		swal({
            title: "Are you sure?",
            text: "You want to delete this user?", 
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
          if (willDelete) {
			id = $(this).closest("tbody tr").find("td:eq(0)").html()
		sample = $(this).closest("tbody tr").find("td").remove()
		$.ajax({
			type: "POST",
			url: "{% url 'deleteuser' %}",
			data:{
				del_user_id: id,
				
				csrfmiddlewaretoken: "{{ csrf_token }}",
			},
			success: function(data){
				swal("Success! User has been deleted", {
		              icon: "success",
		            }).then((willreload) => {
		            	if(willreload){
		            		window.location.reload()
		            	}
		            	
		            });
			},
			error: function(error){
				console.log(error);
			}
		
		});
          } 
        });
	});
	
</script>
{% endblock %}

